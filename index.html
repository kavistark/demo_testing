<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Valve Control - Serial Commands</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
            color: white;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .section h3 {
            color: #f39c12;
            margin-bottom: 15px;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 5px;
        }

        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .command-item {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .command-item:hover {
            border-color: #f39c12;
            background: rgba(255,255,255,0.3);
        }

        .command-title {
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 8px;
        }

        .command-text {
            background: #2c3e50;
            color: #00ff00;
            padding: 8px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .command-desc {
            font-size: 12px;
            color: #bdc3c7;
        }

        .valve-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .valve-item {
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .valve-number {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 5px;
        }

        .valve-commands {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .valve-cmd {
            background: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }

        .valve-cmd.close {
            background: #e74c3c;
        }

        .instructions {
            background: #f39c12;
            color: #2c3e50;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .instructions h4 {
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .app-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .app-card {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .app-name {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .copy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        .copy-btn:hover {
            background: #2ecc71;
        }

        .copy-btn:active {
            background: #229954;
        }

        .status-section {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
        }

        .status-section h4 {
            color: #3498db;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            .command-grid {
                grid-template-columns: 1fr;
            }
            
            .valve-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 Valve Control System</h1>
            <p>Bluetooth Serial Commands Interface</p>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h4>📱 How to Connect via Bluetooth Serial App:</h4>
            <ol>
                <li><strong>Pair HC-05:</strong> Settings → Bluetooth → "HC-05" (PIN: 1234)</li>
                <li><strong>Download App:</strong> Install "Serial Bluetooth Terminal" from Play Store</li>
                <li><strong>Connect:</strong> Open app → Connect to "HC-05"</li>
                <li><strong>Send Commands:</strong> Type/copy commands below and press Enter</li>
                <li><strong>Monitor:</strong> Watch responses from Arduino system</li>
            </ol>
        </div>

        <!-- Recommended Apps -->
        <div class="section">
            <h3>📱 Recommended Bluetooth Terminal Apps</h3>
            <div class="app-links">
                <div class="app-card">
                    <div class="app-name">Serial Bluetooth Terminal</div>
                    <div>by Kai Morich</div>
                    <div style="font-size: 12px; margin-top: 5px;">Best compatibility with HC-05</div>
                </div>
                <div class="app-card">
                    <div class="app-name">Bluetooth Terminal HC-05</div>
                    <div>by ViliusSoft</div>
                    <div style="font-size: 12px; margin-top: 5px;">Designed specifically for HC-05</div>
                </div>
                <div class="app-card">
                    <div class="app-name">Arduino Bluetooth Controller</div>
                    <div>by Giumig Apps</div>
                    <div style="font-size: 12px; margin-top: 5px;">Arduino-focused interface</div>
                </div>
            </div>
        </div>

        <!-- System Commands -->
        <div class="section">
            <h3>🔄 System Commands</h3>
            <div class="command-grid">
                <div class="command-item" onclick="copyCommand('GET_STATUS')">
                    <div class="command-title">Get Status</div>
                    <div class="command-text">GET_STATUS</div>
                    <div class="command-desc">Returns weight, valve count, system status</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('CLOSE_ALL')">
                    <div class="command-title">Emergency Stop</div>
                    <div class="command-text">CLOSE_ALL</div>
                    <div class="command-desc">Closes all valves immediately</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('TARE_SCALE')">
                    <div class="command-title">Tare Scale</div>
                    <div class="command-text">TARE_SCALE</div>
                    <div class="command-desc">Sets load cell to zero</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('EMERGENCY_STOP')">
                    <div class="command-title">Emergency Stop</div>
                    <div class="command-text">EMERGENCY_STOP</div>
                    <div class="command-desc">Complete system shutdown</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
            </div>
        </div>

        <!-- Process Commands -->
        <div class="section">
            <h3>🔄 Process Commands</h3>
            <div class="command-grid">
                <div class="command-item" onclick="copyCommand('PROCESS_1')">
                    <div class="command-title">💧 Affusion Process</div>
                    <div class="command-text">PROCESS_1</div>
                    <div class="command-desc">12-step affusion sequence</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('PROCESS_2')">
                    <div class="command-title">🧽 Cleaning Process</div>
                    <div class="command-text">PROCESS_2</div>
                    <div class="command-desc">8-step cleaning sequence</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('PROCESS_3')">
                    <div class="command-title">🔄 Rinse Process</div>
                    <div class="command-text">PROCESS_3</div>
                    <div class="command-desc">5-step rinse sequence</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
                
                <div class="command-item" onclick="copyCommand('PROCESS_4')">
                    <div class="command-title">📏 Volume Test</div>
                    <div class="command-text">PROCESS_4</div>
                    <div class="command-desc">10-step TBV testing</div>
                    <button class="copy-btn">Copy Command</button>
                </div>
            </div>
        </div>

        <!-- Manual Valve Control -->
        <div class="section">
            <h3>⚙️ Manual Valve Control</h3>
            <div class="valve-grid">
                <!-- Regular Valves 1-21 -->
                <div class="valve-item">
                    <div class="valve-number">V01</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_1')">OPEN_1</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_1')">CLOSE_1</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V02</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_2')">OPEN_2</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_2')">CLOSE_2</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V03</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_3')">OPEN_3</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_3')">CLOSE_3</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V04</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_4')">OPEN_4</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_4')">CLOSE_4</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V05</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_5')">OPEN_5</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_5')">CLOSE_5</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V06</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_6')">OPEN_6</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_6')">CLOSE_6</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V07</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_7')">OPEN_7</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_7')">CLOSE_7</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V08</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_8')">OPEN_8</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_8')">CLOSE_8</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V09</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_9')">OPEN_9</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_9')">CLOSE_9</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V10</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_10')">OPEN_10</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_10')">CLOSE_10</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V11</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_11')">OPEN_11</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_11')">CLOSE_11</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V12</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_12')">OPEN_12</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_12')">CLOSE_12</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V13</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_13')">OPEN_13</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_13')">CLOSE_13</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V14</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_14')">OPEN_14</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_14')">CLOSE_14</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V15</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_15')">OPEN_15</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_15')">CLOSE_15</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V16</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_16')">OPEN_16</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_16')">CLOSE_16</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V17</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_17')">OPEN_17</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_17')">CLOSE_17</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V18</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_18')">OPEN_18</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_18')">CLOSE_18</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V19</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_19')">OPEN_19</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_19')">CLOSE_19</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V20</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_20')">OPEN_20</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_20')">CLOSE_20</div>
                    </div>
                </div>
                
                <div class="valve-item">
                    <div class="valve-number">V21</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_21')">OPEN_21</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_21')">CLOSE_21</div>
                    </div>
                </div>
                
                <!-- AP Valve (Special) -->
                <div class="valve-item" style="border: 2px solid #e74c3c;">
                    <div class="valve-number" style="color: #e74c3c;">AP</div>
                    <div class="valve-commands">
                        <div class="valve-cmd" onclick="copyCommand('OPEN_99')">OPEN_99</div>
                        <div class="valve-cmd close" onclick="copyCommand('CLOSE_99')">CLOSE_99</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expected Responses -->
        <div class="section">
            <h3>📡 Expected Arduino Responses</h3>
            <div class="status-section">
                <h4>System Status Response:</h4>
                <div>STATUS:{"weight":125.40,"active_valves":3,"system_running":false,"process":0,"uptime":123456,"valve_states":42}</div>
                
                <h4 style="margin-top: 15px;">Valve Operations:</h4>
                <div>VALVE_OPEN:12 (when valve opens)</div>
                <div>VALVE_CLOSE:5 (when valve closes)</div>
                <div>ALL_VALVES_CLOSED (when all close)</div>
                
                <h4 style="margin-top: 15px;">Process Updates:</h4>
                <div>PROCESS_START:AFFUSION,12</div>
                <div>STEP:1,12,Emptying</div>
                <div>STEP:2,12,Air vent</div>
                <div>PROCESS_COMPLETE:AFFUSION</div>
                
                <h4 style="margin-top: 15px;">Weight Data:</h4>
                <div>WEIGHT:125.40</div>
                <div>WEIGHT_REACHED:100.00</div>
                <div>SCALE_TARED</div>
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="section">
            <h3>🔧 Troubleshooting</h3>
            <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <h4 style="color: #e74c3c; margin-bottom: 10px;">If Commands Don't Work:</h4>
                <ul style="margin-left: 20px;">
                    <li>Check HC-05 LED is blinking (discoverable) or solid (connected)</li>
                    <li>Verify Arduino Serial Monitor shows "ARDUINO_READY"</li>
                    <li>Ensure HC-05 is paired with your device (PIN: 1234)</li>
                    <li>Try sending "GET_STATUS" first to test connection</li>
                    <li>Check wiring: HC-05 VCC→5V, GND→GND, TXD→Pin10, RXD→Pin11</li>
                </ul>
            </div>
            
            <div style="background: rgba(243, 156, 18, 0.2); padding: 15px; border-radius: 8px;">
                <h4 style="color: #f39c12; margin-bottom: 10px;">Connection Tips:</h4>
                <ul style="margin-left: 20px;">
                    <li>Use "Serial Bluetooth Terminal" app for best compatibility</li>
                    <li>Set line ending to "Both NL & CR" in app settings</li>
                    <li>Commands are case-insensitive (OPEN_1 = open_1)</li>
                    <li>Wait for response before sending next command</li>
                    <li>Use EMERGENCY_STOP if system gets stuck</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Copy command to clipboard
        function copyCommand(command) {
            navigator.clipboard.writeText(command).then(function() {
                // Show feedback
                showCopyFeedback(command);
            }).catch(function(err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = command;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyFeedback(command);
            });
        }

        // Show copy feedback
        function showCopyFeedback(command) {
            // Create temporary notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 9999;
                font-weight: bold;
            `;
            notification.textContent = `Copied: ${command}`;
            
            document.body.appendChild(notification);
            
            // Remove after 2 seconds
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        // Add click handlers to all command items
        document.addEventListener('DOMContentLoaded', function() {
            const commandItems = document.querySelectorAll('.command-item');
            commandItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.classList.contains('copy-btn')) {
                        e.stopPropagation();
                        return;
                    }
                    
                    const commandText = item.querySelector('.command-text').textContent;
                    copyCommand(commandText);
                });
            });
        });
    </script>
</body>
</html>
